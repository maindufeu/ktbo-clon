{"Adwords | Splitfield_Taxonomy": [["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "{Campaign} if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client_name", "Brand_portfolio", "Temporality", "Platform", "Vendor", "Initiative", "Objective", "Buying Type", "Consumption Occasion"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Test", "expression": "'test'", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Zucaritas' if re.match('.*Recreate.*',{Campaign}) else 'Parati' if re.match('.*SonhosRealizados.*',{Campaign}) else {Brand_portfolio}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "str({Brand_portfolio}).lower().replace(\" \",\"\")", "_comment": null}], ["convertx", {"subtable": null, "field": "Market", "expression": "'Brasil' if not {Market} and re.match('.*(SonhosRealizados|BRASIL).*',{Campaign}) else 'Argentina' if not {Market} and re.match('.*ARGENTINA.*',{Campaign}) else 'Paraguay' if not {Market} and re.match('.*PARAGUAI.*',{Campaign}) else {Market}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Market", "mapping": "Country codes Mapping General", "fieldname": "Country_iso_code", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country_iso_code", "mapping": "Country Codes to Country Full Name", "fieldname": "Country_full_name", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "Google Ads | Campaign_without_Taxonomy", "fieldname": "*", "if": "not {Campaign_duplicate}", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "unified_brand", "mapping": "General Dashboard | Unified Brand Mapping", "fieldname": "Brand", "_comment": null}], ["cutout", {"subtable": null, "fields": ["*", "Test"], "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buying Type", "_comment": null}], ["convertx", {"subtable": null, "field": "New Buying Type", "expression": "\"CPCV\" if re.match(\".*CPCV.*\", {Campaign}) else {New Buying Type}", "failonerror": false, "_comment": null}]], "Campaing Sentiment | CountryCode corrections": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "CountryCode", "mapping": "Campaing Sentiment | CountryCodes", "fieldname": "New CountryCode", "_comment": null}], ["convertx", {"subtable": null, "field": "CountryCode", "expression": "{New CountryCode} if {New CountryCode}  else {CountryCode}", "_comment": null}]], "Complete views": [["addfieldx", {"index": null, "subtable": null, "field": "numeric_view_rate", "expression": "{View rate}.replace(\"%\",\"\")", "_comment": null}], ["convertnumbers", {"fields": ["numeric_view_rate", "Views"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "complete_views_calculated", "expression": "{numeric_view_rate}*{Views}/100", "_comment": null}]], "Content Dash - Add organic content type": [["addfieldx", {"subtable": null, "index": null, "field": "content_type", "expression": "\"Organic\"", "_comment": null}]], "Country Codes": [["map", {"errors": "raise", "missing": "create,stop", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Market", "mapping": "Country codes Mapping General", "fieldname": "Country_code", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Country codes Mapping General", "fieldname": "Country_code2", "if": "not {Market}", "_comment": null}], ["convertx", {"subtable": null, "field": "Country_code", "expression": "{Country_code2} if not {Country_code} else {Country_code}", "_comment": null}]], "Coupon Redemption Data | Select valid data": [["select", {"complement": false, "subtable": null, "where": "{Date}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "coupons_redeemed", "expression": "{Cupones}", "_comment": null}], ["#convertnumbers", {"fields": ["coupons_redeemed"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}]], "Custom Script": [["join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": true, "all": true, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": true, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "subtable": null, "keys": ["Ad ID", "Campaign ID"], "streams": ["Google Ads - Video Report"], "columns": ["Video Title", "Video Duration", "Video Id"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}]], "Custom Script 1": [["#convert", {"failonerror": false, "subtable": null, "field": ["Campaign Name"], "converter": "lower", "_comment": null}], ["convertx", {"failonerror": true, "subtable": null, "field": "Package Name", "expression": "{Package Name}.replace('_300x250_','#')", "_comment": null}]], "Custom Script 2": [["convertx", {"failonerror": true, "subtable": null, "field": "video_duration_sec", "expression": "int(video_duration_sec)", "_comment": null}]], "Custom Script 3": [["addfieldx", {"index": null, "subtable": null, "field": "Inititative_Test", "expression": "{Initiative}", "_comment": null}]], "ECB | Currency Conversion": [["cut", {"subtable": null, "fields": ["USD", "Date", "BRL", "MXN"], "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "re.match('.*2019|2020.*',{Date})", "_comment": null}], ["filltimegaps", {"interval": "days", "presorted": false, "subtable": null, "timestamp_field": "Date", "timestamp_format": "%Y-%m-%d", "_comment": null}], ["filldown", {"subtable": null, "fields": ["USD", "BRL", "MXN"], "_comment": null}], ["convertnumbers", {"fields": ["USD", "BRL", "MXN"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "BRL to USD", "expression": "{BRL}/{USD}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "MXN to USD", "expression": "{MXN}/{USD}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "COP to USD", "expression": "3912.01", "_comment": null}]], "Excel File Upload": [["xlsx", {"read_only": true, "include_sheet_name": false, "data_only": true, "guess_types": false, "ignore_missing_sheet": false, "include_all_sheets": false, "keep_links": true, "force_fix": false, "subtable": null, "keep_vba": false, "sheets": [{"row_offset": 21, "column_offset": 0, "sheet": "Custom_Report_Builder"}], "meta_mapping": {}, "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Ad Format} and {Brand}", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Name", "expression": "{Campaign Name}.replace(\"M\u00e9xico\", \"Mexico\")", "_comment": null}]], "Facebook Ads | Paid Media | Monthly reach JOIN": [["addfieldx", {"index": null, "subtable": null, "field": "date_month", "expression": "int({date_start}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "reach_key", "expression": "str({campaign_id})+\"-\"+str({date_month})", "_comment": null}], ["#join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": false, "all": false, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": false, "ignore_join_date": false, "include_tags": null, "exclude_tags": null, "subtable": null, "keys": ["reach_key"], "streams": ["Facebook Ads | Reach Monthly"], "columns": ["campaign_monthly_reach"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}]], "Facebook Ads | Paid Media | Monthly reach JOIN 2/2": [["join", {"lkey": null, "rkey": null, "how": "left", "errors": "ignore", "distinct": false, "all": false, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": false, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "lstart": null, "lstop": null, "rstart": null, "rstop": null, "subtable": null, "keys": ["reach_key"], "streams": ["Facebook Ads | Reach Monthly"], "columns": ["campaign_monthly_reach"], "_comment": null}]], "Facebook| Campaign Label from Name": [["addfieldx", {"subtable": null, "index": null, "field": "campaign_label", "expression": "{campaign_name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({campaign_name}.split(\"_\")[:12]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)_(.*).*',{campaign_name}) else ''", "_comment": null}], ["convertx", {"subtable": null, "field": "campaign_name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\") if {campaign_with_taxonomy} else {campaign_name}.replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand_portfolio}.lower().replace(\" \",\"\")", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Datasource", "expression": "\"Facebook Ads Insights\"", "_comment": null}]], "Facebook Demographics": [["addfieldx", {"subtable": null, "index": null, "field": "Gender", "expression": "\"Female\" if re.match(\".*F.*\", {Gender Age}) else \"Male\" if re.match(\".*M.*\", {Gender Age}) else \"Undefined\"", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Age", "expression": "{Gender Age}.split(\".\")[1]", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Country", "fieldname": "Country Name", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Brand", "fieldname": "Brand", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "\"Zucaritas\" if re.match(\".*sucrilhos.*\", {Link}) else {Brand}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country Name", "mapping": "Country Codes", "fieldname": "country_code", "_comment": null}]], "Facebook Demographics | LATAM filter correction": [["convertx", {"subtable": null, "field": "country_code", "expression": "\"LATAM\" if {country_code} == \"Latam\" else \"CENAM\" if {country_code} == \"Cenam\" else \"LATAM\" if {country_code} == \"LATAM\" else \"CENAM\" if {country_code} == \"CENAM\" else \"BR\" if re.match(\".*sucrilhos.*\", {Link}) else {country_code}", "_comment": null}], ["convertx", {"subtable": null, "field": "Country Name", "expression": "\"Brazil\" if re.match(\".*sucrilhos.*\", {Link}) else {Country}", "_comment": null}]], "Facebook | Filter Publisher Platform": [["select", {"complement": false, "subtable": null, "where": "{publisher_platform}=='instagram'", "_comment": null}]], "Facebook Geographics": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Country", "fieldname": "Country Name", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Brand", "fieldname": "Brand", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "\"Zucaritas\" if re.match(\".*sucrilhos.*\", {Link}) else {Brand}", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country Name", "mapping": "Country Codes", "fieldname": "country_code", "_comment": null}]], "Facebook Insights | Organic Paid Filter": [["addfieldx", {"subtable": null, "index": null, "field": "paid_impressions", "expression": "{Impressions (Paid)}", "_comment": null}], ["convertnumbers", {"fields": ["paid_impressions"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "content_type", "expression": "\"Organic\" if {paid_impressions} == 0 else \"Paid\"", "_comment": null}]], "Facebook  | Interactions metric": [["convertnumbers", {"fields": ["actions.post_reaction", "actions.comment", "actions.post", "actions.link_click", "impressions"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "interactions", "expression": "{actions.post} + {actions.post_reaction} + {actions.comment} + {actions.link_click}", "_comment": null}]], "Facebook | Join Cost Currency Conversion": [["join", {"concatenate": false, "right_select": null, "all": false, "lkey": ["date_start"], "rkey": ["Date"], "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": false, "how": "left", "exclude_tags": null, "distinct": false, "streams": ["Currency Conversion"], "columns": ["BRL to USD", "MXN to USD"], "_comment": null}], ["convertnumbers", {"fields": ["spend", "BRL to USD", "MXN to USD"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["convertx", {"subtable": null, "field": "BRL to USD", "expression": "5.70 if {BRL to USD} == 0 else {BRL to USD}", "_comment": null}], ["convertx", {"subtable": null, "field": "MXN to USD", "expression": "20.96 if {MXN to USD}== 0 else {MXN to USD}", "failonerror": false, "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Cost in BRL", "expression": "{spend} if {account_currency}=='BRL' else ({spend}*{BRL to USD}) if {account_currency}=='USD'else ({spend}*0.23) if {account_currency}=='MXN'else {spend}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "platform_cost", "expression": "({spend}/{BRL to USD}) if re.match('.*BRL.*',{account_currency}) else ({spend}/{MXN to USD}) if re.match('.*MXN',{account_currency}) else {spend}", "_comment": null}], ["#convertx", {"subtable": null, "field": "spend", "expression": "({spend}/{BRL to USD}) if re.match('.*BRL.*',{account_currency}) else ({spend}/{MXN to USD}) if re.match('.*MXN',{account_currency}) else {spend}", "_comment": null}], ["#convertx", {"subtable": null, "field": "account_currency", "expression": "'USD' if {account_currency}=='BRL' else 'USD' if {account_currency}=='MXN' else {account_currency}", "_comment": null}]], "Facebook KWIN - Data preparation": [["#addfieldx", {"subtable": null, "index": null, "field": "Clicks", "expression": "{actions.link_click}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Engagements", "expression": "{actions.post_engagement}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Impressions", "expression": "{impressions}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Video.Views", "expression": "{actions.video_view}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Video.Completions", "expression": "{video_p100_watched_actions.video_view}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Cost.Type", "expression": "{Buying Type}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "KPI Units", "expression": "{Impressions} if {Cost.Type} == \"CPM\" else {Clicks} if {Cost.Type} == \"CPC\" else {Video.Views} if {Cost.Type} == \"CPV\" else {Video.Completions} if {Cost.Type} == \"CPCV\" else {Engagements}  if {Cost.Type} == \"CPE\" else 0", "_comment": null}], ["#convertnumbers", {"fields": ["platform_cost", "KPI Units"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "KPI Unit Cost", "expression": "{platform_cost}/{KPI Units} if {KPI Units} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Year", "expression": "{date_start}.split(\" \")[0].split(\"-\")[0]", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Month", "expression": "{date_start}.split(\" \")[0].split(\"-\")[1]", "_comment": null}], ["#convertnumbers", {"fields": ["Year", "Month"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Quarter", "expression": "1 if {Month} in [1,2,3] else 2 if {Month} in [4,5,6] else 3 if {Month} in [7,8,9] else 4 if {Month} in [10,11,12] else 0", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Market", "mapping": "KWIN - Market to Region", "fieldname": "Region", "_comment": null}], ["#addfieldx", {"index": null, "subtable": null, "field": "id_key", "expression": "str({Datasource})+str({Region})+str({Cost.Type})+str({Year})+str({Quarter}).replace(\" \",\"\")", "_comment": null}], ["#join", {"concatenate": true, "right_select": null, "all": false, "lkey": null, "rkey": null, "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": true, "how": "left", "exclude_tags": null, "distinct": false, "keys": ["id_key"], "streams": ["KWIN Central Tendencies"], "columns": ["Central.KPI", "Central.Cost", "Central.Clicks", "Central.Engagements", "Central.Impressions", "Central.Video.Views", "Central.Video.Completions"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}], ["#convertnumbers", {"fields": ["Central.KPI", "Central.Clicks", "Central.Engagements", "Central.Impressions", "Central.Video.Views", "Central.Video.Completions", "Clicks", "Engagements", "Impressions", "Video.Views", "Video.Completions", "KPI Unit Cost", "Central.Cost"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Primary Factor", "expression": "{KPI Units} / {Central.KPI} if {Central.KPI} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Clicks Secondary Factor", "expression": "0.25*{Clicks} / {Central.Clicks} if {Central.Clicks} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Engagements Secondary Factor", "expression": "0.25*{Engagements} / {Central.Engagements} if {Central.Engagements} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Impressions Secondary Factor", "expression": "0.25*{Impressions} / {Central.Impressions} if {Central.Impressions} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Video Views Secondary Factor", "expression": "0.25*{Video.Views} / {Central.Video.Views} if {Central.Video.Views} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Video Completions Secondary Factor", "expression": "0.25*{Video.Completions} / {Central.Video.Completions} if {Central.Video.Completions} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Cost Factor", "expression": "{KPI Unit Cost}/{Central.Cost} if {Central.Cost} > 0 else 0", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Secondary Factor", "expression": "({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPM\" else ({Impressions Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPC\" else ({Clicks Secondary Factor} + {Impressions Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPE\" else ({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Impressions Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPV\" else ({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Impressions Secondary Factor}) if {Cost.Type} == \"CPCV\" else 0", "_comment": null}], ["#convertnumbers", {"fields": ["Primary Factor", "Secondary Factor", "Cost Factor"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "KWIN 1st Approach", "expression": "{Primary Factor} + {Secondary Factor} - {Cost Factor}", "_comment": null}]], "Facebook KWIN - No Null Data": [["select", {"complement": false, "subtable": null, "where": "{KWIN 1st Approach} != 0", "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{KWIN 1st Approach} != \"0\"", "_comment": null}]], "Facebook KWIN - Split Taxonomy": [["addfieldx", {"subtable": null, "index": null, "field": "Campaign Label", "expression": "{campaign_name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "{campaign_name} if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)',{campaign_name}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Vendor", "Platform", "Objective", "Buying Type"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Campaign_without_Taxonomy", "fieldname": "*", "if": "not {Campaign_duplicate}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["*"], "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Kelloggs' if {Brand_portfolio}=='Hazlo Tuyo' else 'Kelloggs' if {Brand_portfolio}=='Inovation' else 'Zucaritas'if {Brand_portfolio}=='Recreate' else 'Kelloggs Extra' if {Brand_portfolio}=='Extra'else {Brand_portfolio}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*ParaTi.*',{campaign_name}) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{campaign_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Recreate.*',{campaign_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "failonerror": true, "_comment": null}], ["#convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*parati.*',{account_name}.lower()) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{account_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Zucaritas.*',{account_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "failonerror": true, "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Consumption Occasion", "fieldname": "Consumption Occasion", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "unified_brand", "expression": "{Brand_portfolio}.lower().replace(' ', '')", "_comment": null}]], "Facebook| Mediaplan Upercase Identifier": [["addfieldx", {"subtable": null, "index": null, "field": "Temp Campaign Name", "expression": "{campaign_name}.upper()", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_copy", "expression": "{date_start}", "_comment": null}], ["convertdates", {"strict": false, "auto": false, "fields": ["date_copy"], "subtable": null, "datetime": true, "format": " %d-%m-%y", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_month", "expression": "int({date_copy}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "mplan_agency", "expression": "\"Mediacom\" if re.match(\".*MCM.*\", {Temp Campaign Name}) else \"KTBO\"", "_comment": null}], ["convertx", {"subtable": null, "field": "campaign_name", "expression": "{Temp Campaign Name}", "_comment": null}]], "Facebook Montly Reach | Rename column and month break": [["addfieldx", {"index": null, "subtable": null, "field": "date_month", "expression": "int({date_start}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "campaign_monthly_reach", "expression": "{reach}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "reach_key", "expression": "str({campaign_id})+\"-\"+str({date_month})", "_comment": null}]], "Facebook Page | Country Mapping": [["map", {"errors": "ignore", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Name", "mapping": "Facebook | Pagre Country Mapping", "fieldname": "Country Name", "_comment": null}]], "Facebook Page | Extract Page Name": [["convertx", {"subtable": null, "field": "Page Name", "expression": "{Link}.split('/')[3]", "_comment": null}], ["convertx", {"subtable": null, "field": "Page Name", "expression": "{Page Name}.strip('/')", "_comment": null}]], "Facebook Page Insights | Interactions Metric": [["convertnumbers", {"fields": ["Shares", "Comments", "Link Clicks", "Likes"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "interactions", "expression": "{Shares}+{Comments}+{Link Clicks}+{Likes}", "_comment": null}]], "Facebook | Page Mapping": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Brand", "fieldname": "Brand", "_comment": null}]], "Facebook Post | Content Type": [["addfieldx", {"subtable": null, "index": null, "field": "paid_impressions", "expression": "str({Impressions (Paid)})", "_comment": null}], ["convertnumbers", {"fields": ["paid_impressions"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "content_type", "expression": "\"Organic\" if {paid_impressions} == 0 else \"Paid\"", "_comment": null}]], "Facebook | Post Country Name": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Page Id", "mapping": "Facebook | Page ID to Country", "fieldname": "Country Name", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country Name", "mapping": "All Sources | Country Names to ISO3 Code", "fieldname": "Country Code", "_comment": null}]], "Facebook Reach | Split Taxonomy": [["addfieldx", {"subtable": null, "index": null, "field": "Campaign Label", "expression": "{campaign_name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "{campaign_name} if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)',{campaign_name}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Vendor", "Platform", "Objective", "Buying Type"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Campaign_without_Taxonomy", "fieldname": "*", "if": "not {Campaign_duplicate}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["*"], "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Kelloggs' if {Brand_portfolio}=='Masterbrand' else 'Kelloggs' if {Brand_portfolio}=='Corporate Promotions' else 'Kelloggs' if {Brand_portfolio}=='Hazlo Tuyo' else 'Kelloggs' if {Brand_portfolio}=='Inovation' else 'Zucaritas'if {Brand_portfolio}=='Recreate' else 'Kelloggs Extra' if {Brand_portfolio}=='Extra'else {Brand_portfolio}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*ParaTi.*',{campaign_name}) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{campaign_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Recreate.*',{campaign_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*parati.*',{account_name}.lower()) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{account_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Zucaritas.*',{account_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Consumption Occasion", "fieldname": "Consumption Occasion", "_comment": null}]], "Facebook | Splitfield_Taxonomy": [["addfieldx", {"subtable": null, "index": null, "field": "Campaign Label", "expression": "{campaign_name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "{campaign_name} if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{campaign_name}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Vendor", "Platform", "Objective", "Buying Type"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Campaign_without_Taxonomy", "fieldname": "*", "if": "not {Campaign_duplicate}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["*"], "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Kelloggs' if {Brand_portfolio}=='Hazlo Tuyo' else 'Kelloggs' if {Brand_portfolio}=='Inovation' else 'Zucaritas'if {Brand_portfolio}=='Recreate' else 'Kelloggs Extra' if {Brand_portfolio}=='Extra'else {Brand_portfolio}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*ParaTi.*',{campaign_name}) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{campaign_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Recreate.*',{campaign_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand_portfolio", "expression": "'Parati' if re.match('.*parati.*',{account_name}.lower()) and not {Brand_portfolio}  else 'Pringles' if re.match('.*pringles.*',{account_name}.lower()) and not {Brand_portfolio} else 'Zucaritas'if re.match('.*Zucaritas.*',{account_name}) else 'Kelloggs' if re.match('.*froot loops.*',{campaign_name}.lower()) and not {Brand_portfolio} else {Brand_portfolio}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Consumption Occasion", "fieldname": "Consumption Occasion", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "video_quartile_25_view", "expression": "{video_p25_watched_actions.video_view}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "video_views", "expression": "{video_p25_watched_actions.video_view}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "url", "expression": "{ad_preview_default_url}", "_comment": null}], ["#addfieldx", {"subtable": null, "index": null, "field": "Country Code", "expression": "\"CENAM\" if re.match(\".*cenam.*\", {campaign_name}.lower()) else \"CENAM\" if re.match(\".*several.*\", {campaign_name}.lower()) else {country}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Month", "expression": "int({date_start}.split(\"-\")[1])", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign_duplicate", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buying Type", "_comment": null}], ["convertx", {"subtable": null, "field": "New Buying Type", "expression": "\"CPCV\" if re.match(\".*CPCV.*\",{campaign_name}) else {New Buying Type}", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "campaign_name", "mapping": "Country codes Mapping General", "fieldname": "Country Code", "_comment": null}]], "General Dashboard | Unified Brand Naming": [["cutout", {"subtable": null, "fields": ["Brand", "Other Brand"], "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "unified_brand", "mapping": "General Dashboard | Unified Brand Mapping", "fieldname": "Brand", "_comment": null}]], "Google Ads | Campaign Label from Name": [["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign}.split(\"_\")[:12]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign}) else ''", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\") if {campaign_with_taxonomy} else {Campaign}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand_portfolio}.replace(\" \",\"\").lower()", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Datasource", "expression": "\"Google Adwords\"", "_comment": null}]], "Google Ads | Currency": [["addfieldx", {"index": null, "subtable": null, "field": "year_month", "expression": "'-'.join(({Day}.split(\"-\")[0:2]))", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "currency_key", "expression": "'_'.join([{Currency},{Market},{year_month}])", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "create", "notify": true, "subtable": null, "sourcefield": "currency_key", "mapping": "currency by month", "fieldname": "convertion_value", "_comment": null}], ["convertnumbers", {"fields": ["convertion_value", "Cost"], "default": 1, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "platform_cost", "expression": "{convertion_value}*{Cost}", "_comment": null}]], "Google Ads | Join Cost Currency Conversion": [["addfieldx", {"subtable": null, "index": null, "field": "Original Cost", "expression": "{Cost}", "_comment": null}], ["join", {"concatenate": false, "right_select": null, "all": false, "lkey": ["Day"], "rkey": ["Date"], "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": false, "how": "left", "exclude_tags": null, "distinct": false, "streams": ["Currency Conversion"], "columns": ["BRL to USD", "MXN to USD"], "_comment": null}], ["convertnumbers", {"fields": ["Cost", "BRL to USD", "MXN to USD"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Cost in BRL", "expression": "{Cost} if {Currency}=='BRL' else ({Cost}*{BRL to USD}) if {Currency}=='USD'else ({Cost}*0,23) if {Currency}=='MXN'else {Cost}", "_comment": null}], ["convertx", {"subtable": null, "field": "Cost", "expression": "({Cost}/{BRL to USD}) if re.match('.*BRL.*',{Currency}) else ({Cost}/{MXN to USD}) if re.match('.*MXN',{Currency}) else {Cost}", "_comment": null}], ["#convertx", {"subtable": null, "field": "Currency", "expression": "'USD' if {Currency}=='BRL' else {Currency}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "platform_cost", "expression": "{Cost}", "_comment": null}]], "Google Ads | video duration sec": [["convertnumbers", {"fields": ["Video Duration"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "video_duration_sec", "expression": "int({Video Duration}/1000)", "_comment": null}]], "Google Ads | Video join": [["#join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": false, "all": false, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": true, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "subtable": null, "keys": ["Ad ID"], "streams": ["Google Ads - Video Report"], "columns": ["Video Title", "Video Duration", "Video Id"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}]], "Google Analytics | Extract Country and Brand": [["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "ga:webPropertyName", "mapping": "Country mapping", "fieldname": "Country", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "ga:webPropertyName", "mapping": "Brands Mapping", "fieldname": "Brand", "_comment": null}]], "Google Analytics | Time on Page formatting": [["convertnumbers", {"fields": ["ga:sessions", "ga:timeOnPage"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Formatted Time Page", "expression": "{ga:timeOnPage}/{ga:sessions} if {ga:sessions} > 0 else 0", "_comment": null}], ["convertnumbers", {"fields": ["Formatted Time Page"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Seconds", "expression": "int({Formatted Time Page}%60)", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Minutes", "expression": "int({Formatted Time Page}/60)", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Hours", "expression": "int({Minutes}/60) if {Minutes} > 60 else 0", "_comment": null}], ["convertx", {"subtable": null, "field": "Minutes", "expression": "int({Minutes}/60) if {Minutes} > 60 else {Minutes}", "_comment": null}], ["convertx", {"subtable": null, "field": "Seconds", "expression": "\"0\"+str({Seconds}) if len(str({Seconds})) == 1 else str({Seconds})", "_comment": null}], ["convertx", {"subtable": null, "field": "Minutes", "expression": "\"0\"+str({Minutes}) if len(str({Minutes})) == 1 else str({Minutes})", "_comment": null}], ["convertx", {"subtable": null, "field": "Hours", "expression": "\"0\"+str({Hours}) if len(str({Hours})) == 1 else str({Hours})", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "TimeOnPageDim", "expression": "str({Hours})+\":\"+str({Minutes})+\":\"+str({Seconds})", "_comment": null}]], "Google | Uppercase identifier": [["addfieldx", {"subtable": null, "index": null, "field": "Temp Campaign Name", "expression": "{Campaign}.upper()", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_copy", "expression": "{Day}", "_comment": null}], ["convertdates", {"strict": false, "auto": false, "fields": ["date_copy"], "subtable": null, "datetime": true, "format": " %d-%m-%y", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_month", "expression": "int({date_copy}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "mplan_agency", "expression": "\"Mediacom\" if re.match(\".*MCM.*\", {Temp Campaign Name}) else \"KTBO\"", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign", "expression": "{Temp Campaign Name}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Temp Campaign Name"], "_comment": null}]], "Influencers| exclude null": [["select", {"complement": false, "subtable": null, "where": "{Campaign}!= \"\"", "_comment": null}]], "Influencers - Minimum tags": [["addfieldx", {"index": null, "subtable": null, "field": "Day", "expression": "{Start Date}", "_comment": null}]], "Influencers |Mininum tags creation": [["addfieldx", {"index": null, "subtable": null, "field": "Day", "expression": "{Start Date}", "_comment": null}]], "Instagram | Brand Mapping": [["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "instagram_name", "mapping": "Instagram | User vs. Brand Mapping", "fieldname": "Brand", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "'Zucaritas' if {Brand}=='Sucrilhos' else {Brand}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "user.username", "expression": "{instagram_username}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.lower().replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}]], "Instagram Business | Stories Brand Map": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "instagram_username", "mapping": "Instagram | User vs. Brand Mapping", "fieldname": "Brand2", "_comment": null}]], "Instagram | Country Mapping": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "user.username", "mapping": "Instagram | Users and Country Mapping", "fieldname": "Country Code", "_comment": null}]], "Instagram Stories | Create Ocurrence": [["addfieldx", {"subtable": null, "index": null, "field": "Ocurrence", "expression": "1", "_comment": null}]], "Instagram Stories | Username to Country": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "instagram_username", "mapping": "Instagram | Users and Country Mapping", "fieldname": "Country Code", "_comment": null}]], "Instagram User | Brand Mapping": [["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "user.username", "mapping": "Brands Mapping", "fieldname": "Brand", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.lower().replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand", "Other Brand"], "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "unified_brand", "mapping": "General Dashboard | Unified Brand Mapping", "fieldname": "Brand", "_comment": null}]], "Interest | Create Occurence (metric)": [["addfieldx", {"subtable": null, "index": null, "field": "Occurence", "expression": "1", "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Platform}", "_comment": null}]], "Join|Influencers": [["join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": true, "all": true, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": true, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "lstart": null, "lstop": null, "rstart": null, "rstop": null, "subtable": null, "keys": ["Campaign", "Touchpoint"], "streams": ["Influencers"], "subtables": [], "columns": ["Tier", "Platform", "Initiative"], "_comment": null}]], "JOIN Test": [["#addfieldx", {"index": null, "subtable": null, "field": "video_key", "expression": "str({Campaign ID})+\"_\"+str({Ad ID})", "_comment": null}], ["join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": true, "all": true, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": true, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "subtable": null, "keys": ["Ad ID", "Campaign ID"], "streams": ["Google Ads - Video Report"], "columns": ["Video Title", "Video Duration", "Video Id"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}]], "KWIN Google - Data preparation": [["addfieldx", {"subtable": null, "index": null, "field": "Clicks", "expression": "{Clicks}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Engagements", "expression": "{Engagements}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Impressions", "expression": "{Impressions}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Video.Views", "expression": "{Views}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Video.Completions", "expression": "{Video Plays 100%}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Cost.Type", "expression": "{Buying Type}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "KPI Units", "expression": "{Impressions} if {Cost.Type} == \"CPM\" else {Clicks} if {Cost.Type} == \"CPC\" else {Video.Views} if {Cost.Type} == \"CPV\" else {Video.Completions} if {Cost.Type} == \"CPCV\" else {Engagements}  if {Cost.Type} == \"CPE\" else 0", "_comment": null}], ["convertnumbers", {"fields": ["platform_cost", "KPI Units"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "KPI Unit Cost", "expression": "{platform_cost}/{KPI Units} if {KPI Units} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Year", "expression": "str({Day}.split(\" \")[0].split(\"-\")[0])[-2:]", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Month", "expression": "{Day}.split(\" \")[0].split(\"-\")[1]", "_comment": null}], ["convertnumbers", {"fields": ["Year", "Month"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Quarter", "expression": "1 if {Month} in [1,2,3] else 2 if {Month} in [4,5,6] else 3 if {Month} in [7,8,9] else 4 if {Month} in [10,11,12] else 0", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Market", "mapping": "KWIN - Market to Region", "fieldname": "Region", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "id_key", "expression": "str({Datasource})+str({Region})+str({Cost.Type})+str({Year})+str({Quarter}).replace(\" \",\"\")", "_comment": null}], ["join", {"concatenate": true, "right_select": null, "all": false, "lkey": null, "rkey": null, "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": true, "how": "left", "exclude_tags": null, "distinct": false, "keys": ["id_key"], "streams": ["KWIN Central Tendencies"], "columns": ["Central.KPI", "Central.Cost", "Central.Clicks", "Central.Engagements", "Central.Impressions", "Central.Video.Views", "Central.Video.Completions", "Region", "Year", "Quarter"], "_comment": null}], ["convertnumbers", {"fields": ["Central.KPI", "Central.Clicks", "Central.Engagements", "Central.Impressions", "Central.Video.Views", "Central.Video.Completions", "Clicks", "Engagements", "Impressions", "Video.Views", "Video.Completions", "KPI Unit Cost", "Central.Cost"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Primary Factor", "expression": "{KPI Units} / {Central.KPI} if {Central.KPI} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Clicks Secondary Factor", "expression": "0.25*{Clicks} / {Central.Clicks} if {Central.Clicks} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Engagements Secondary Factor", "expression": "0.25*{Engagements} / {Central.Engagements} if {Central.Engagements} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Impressions Secondary Factor", "expression": "0.25*{Impressions} / {Central.Impressions} if {Central.Impressions} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Video Views Secondary Factor", "expression": "0.25*{Video.Views} / {Central.Video.Views} if {Central.Video.Views} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Video Completions Secondary Factor", "expression": "0.25*{Video.Completions} / {Central.Video.Completions} if {Central.Video.Completions} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Cost Factor", "expression": "{KPI Unit Cost}/{Central.Cost} if {Central.Cost} > 0 else 0", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Secondary Factor", "expression": "({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPM\" else ({Impressions Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPC\" else ({Clicks Secondary Factor} + {Impressions Secondary Factor} + {Video Views Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPE\" else ({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Impressions Secondary Factor} + {Video Completions Secondary Factor}) if {Cost.Type} == \"CPV\" else ({Clicks Secondary Factor} + {Engagements Secondary Factor} + {Video Views Secondary Factor} + {Impressions Secondary Factor}) if {Cost.Type} == \"CPCV\" else 0", "_comment": null}], ["convertnumbers", {"fields": ["Primary Factor", "Secondary Factor", "Cost Factor"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "KWIN 1st Approach", "expression": "{Primary Factor} + {Secondary Factor} - {Cost Factor}", "_comment": null}]], "KWIN | KEYGEN": [["convertx", {"subtable": null, "field": "Year", "expression": "2020 if {Year} == \"2020\" else 2019 if {Year} == \"2019\" else \"20\"+str({Year})", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "id_key", "expression": "str({Datasource})+str({Region})+str({Cost.Type})+str({Year})+str({Quarter}).replace(\" \",\"\")", "_comment": null}]], "Listening | Create Occurence (metric)": [["addfieldx", {"subtable": null, "index": null, "field": "Occurence", "expression": "1", "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Date}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Brand", "expression": "{QueryName}", "_comment": null}]], "Listening Highlights | Transformations": [["addfieldx", {"subtable": null, "index": null, "field": "Occurence", "expression": "1", "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Date}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "QueryName", "mapping": "Listening | Brand & Competitor", "fieldname": "Brand Filter", "alternative": "", "if": "{QueryName}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Highlights", "mapping": "Listening | Brand & Competitor", "fieldname": "Query Name 2", "if": "not {QueryName}", "_comment": null}], ["convertx", {"subtable": null, "field": "QueryName", "expression": "{Query Name 2} if not {QueryName} else {QueryName}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Query  2"], "_comment": null}]], "Listening Muestra | Brand Filter and Competence Brand": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "QueryName", "mapping": "Listening | Brand & Competitor", "fieldname": "Brand Filter", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Brand", "expression": "\"Zucaritas\" if {QueryName} == \"Sucrilhos\" else {QueryName}", "_comment": null}], ["convertx", {"subtable": null, "field": "Sent", "expression": "'Positive' if re.match('^pos.*',{Sent}.lower()) else 'Negative' if re.match('^neg.*',{Sent}.lower()) else 'Neutral' if re.match('^neutral.*',{Sent}.lower()) else {Sent}", "_comment": null}]], "Listening Muestra | Country Code and Region Mapping": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "CountryCode", "mapping": "Listening | Country Code", "fieldname": "Country Code", "_comment": null}], ["convertx", {"subtable": null, "field": "CountryCode", "expression": "\"\" if not {CountryCode} else {CountryCode}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Region", "expression": "\"Brazil\" if {CountryCode} == \"BR\" else \"Brazil\" if {CountryCode} == \"BRA\"  else \"LATAM\"", "_comment": null}], ["convertx", {"subtable": null, "field": "Region", "expression": "\"Brazil\" if {CountryCode} == \"BR\" else \"Brazil\" if {CountryCode} == \"BRA\"  else \"LATAM\"", "_comment": null}]], "Listening Muestra | Create Ocurrence": [["select", {"complement": false, "subtable": null, "where": "{Date}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Occurence", "expression": "1", "_comment": null}], ["convertx", {"subtable": null, "field": "Title", "expression": "{Title}[:255]", "_comment": null}]], "Listening Muestra | Regional Brands assignation": [["addfieldx", {"subtable": null, "index": null, "field": "Regional Brand", "expression": "{Brand}", "_comment": null}], ["convertx", {"subtable": null, "field": "Regional Brand", "expression": "\"\" if {Regional Brand} not in [\"Parati\", \"Pringles\", \"Zucaritas\", \"Trink\"] and {Region} == \"Brazil\" else {Regional Brand}", "_comment": null}]], "Listening | repair date format": [["addfieldx", {"subtable": null, "index": null, "field": "Date Copy", "expression": "{Date}.split(\" \")[0]", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Day Only", "expression": "{Date Copy}.split(\"-\")[2]", "_comment": null}], ["convertx", {"subtable": null, "field": "Day Only", "expression": "str({Day Only})[-2:]", "_comment": null}], ["convertx", {"subtable": null, "field": "Date Copy", "expression": "\"-\".join(str({Date Copy}).split(\"-\")[0:2])+\"-\"+str({Day Only})", "_comment": null}]], "Listening | Sentiment": [["convertx", {"subtable": null, "field": "Sentiment", "expression": "'Positive' if re.match('^pos.*',{Sentiment}.lower()) else 'Negative' if re.match('^neg.*',{Sentiment}.lower()) else 'Neutral' if re.match('^neutral.*',{Sentiment}.lower()) else {Sentiment}", "_comment": null}]], "Listening Total | Brand Filtre and Competence Brand": [["cutout", {"subtable": null, "fields": ["Brand", "Brand Filter"], "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "QueryName", "mapping": "Listening | Brand & Competitor", "fieldname": "Brand Filter", "_comment": null}], ["convertx", {"subtable": null, "field": "QueryName", "expression": "\"Parati\" if {QueryName} == \"Para ti\" else {QueryName}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Brand", "expression": "\"Zucaritas\" if {QueryName}==\"Sucrilhos\" else {QueryName}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "\"Parati\" if {Brand} == \"Para ti\" else {Brand}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Region", "expression": "\"Brazil\" if {CountryCode} == \"BR\" else \"Brazil\" if {CountryCode} == \"BRA\" else \"LATAM\"", "_comment": null}], ["convertx", {"subtable": null, "field": "Region", "expression": "\"Brazil\" if {CountryCode} == \"BR\" else \"Brazil\" if {CountryCode} == \"BRA\" else \"LATAM\"", "failonerror": false, "_comment": null}]], "Listening Total | Removing error characters": [["convertx", {"subtable": null, "field": "Snippet", "expression": "{Snippet}.replace('\"','').replace(',','')", "_comment": null}], ["convertx", {"subtable": null, "field": "Title", "expression": "{Title}.replace('\"','').replace(',','')", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Region", "expression": "\"Brazil\" if {CountryCode} == \"BR\" else \"LATAM\"", "_comment": null}]], "Listening Wordcloud| Brand & Competitor (Query Name)": [["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "QueryName", "mapping": "Listening | Brand & Competitor", "fieldname": "Brand", "alternative": "", "if": "{QueryName}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Brand Filter", "expression": "{QueryName}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Query  2"], "_comment": null}]], "Mailgun - Manual - Tutorial Data Sciencie Transformation Script": [["addfieldx", {"index": null, "subtable": null, "field": "Occurrence", "expression": "1 if {QueryName} else 0", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "create", "notify": true, "subtable": null, "sourcefield": "QueryName", "mapping": "Mailgun - Manual - Tutorial Data Sciencie QueryName", "fieldname": "Brand", "_comment": null}]], "Mediaplan | Campaign Label from Name": [["addfieldx", {"subtable": null, "index": null, "field": "campaign_label_identifier", "expression": "str(\"_\".join({Campaign Initiative}.split(\"_\")[0:11]) if {Datasource} == \"Other Channels\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:10]) if {Datasource} == \"Sizmek Sas\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Facebook Ads Insights\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Google Adwords\" else {Campaign Initiative})", "_comment": null}], ["convertx", {"subtable": null, "field": "campaign_label_identifier", "expression": "str({campaign_label_identifier}).replace(\" \",\"\")", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.replace(\" \",\"\").lower()", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}]], "Mediaplan - Issue reproduction STEP 2": [["metaaddfield", {"index": null, "subtable": null, "metaname": "custom_meta_information.source_filepath", "fieldname": "Filename", "_comment": null}], ["convertx", {"subtable": null, "field": "Filename", "expression": "({Filename}.strip('/tmp'))[12:]", "_comment": null}], ["#convertx", {"subtable": null, "field": "Filename", "expression": "(str{Filename}.split(\"xlsx'\")[0])", "_comment": null}], ["#convertx", {"subtable": null, "field": "Filename", "expression": "(str{Filename}.split('ktbo')[1])", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": null, "value": "testing workspace", "subtable": null, "fieldname": "adverity_client_name", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": null, "value": "34", "subtable": null, "fieldname": "adverity_client_id", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "adverity_media_plan_name", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "adverity_media_plan_id", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "datastream_extract_filename", "_comment": null}], ["fieldmap", {"mappings": [["Name", "str({Network / Site})"], ["Start", "str({start_date})"], ["End", "str({end_date})"], ["Extend Start", "str({Extend Start})"], ["Extend End", "str({Extend End})"], ["Datasource", "str({Datasource})"], ["Campaign Name", "str(\"_\".join({Campaign Initiative}.split(\"_\")[0:11]) if {Datasource} == \"Other Channels\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:10]) if {Datasource} == \"Sizmek Sas\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Facebook Ads Insights\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Google Adwords\" else {Campaign Initiative}).replace(\" \",\"\")"], ["Country code", "str({Country})"], ["Campaign Label", "str({Campaign Initiative})"], ["Format Type", "str({Format Type})"], ["Buy Type", "str({Buy Type})"], ["Agency", "str({Agency})"], ["Format", "\"\".join(str({Network / Site}).split(\"-\")[:-1])"], ["client_name", "str({Client})"], ["Brand", "str({Brand})"], ["Region", "str({Region})"], ["City", "str({City})"], ["Temporality", "str({Temporality})"], ["Planned Invers", "str(str(\"$\"+{Total Cost}.split(\".\")[0][:-3]+\",\"+{Total Cost}.split(\".\")[0][-3:])+\".\"+str({Total Cost}+\"0\").split(\".\")[1][:2]).replace(\"$,\",\"$\") if {Total Cost} else 0"], ["Target Metric", "str({target_metric})"], ["Target Value", "{KPI Units} if {KPI Units} else 0"], ["Costs 1", "{Media Cost}"], ["Planned Costs 1", "{Total Cost} if {Total Cost} else 0"], ["Cost Model 1", "str({cost_type})"], ["planned_costs", "{Total Cost} if {Total Cost} else 0"]], "failonerror": false, "subtable": null, "_comment": null}], ["#convertnumbers", {"fields": ["Planned Costs 1", "Costs 1"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["preamble", {"fields": [["PLACEMENT", "", "", "", "", "IDENTIFIERS", "", "TAGS", "", "", "", "", "", "", "", "", "", "", "", "TARGET", "", "COSTS", "", "", "STATICS"]], "subtable": null, "_comment": null}], ["#set_meta", {"clear": false, "sourcefield": null, "value": "Test_mediaplan_ktbo", "subtable": null, "fieldname": "adverity_media_plan_id", "_comment": null}]], "Mediaplan | Step 1": [["xlsx", {"read_only": false, "include_sheet_name": false, "data_only": true, "guess_types": false, "ignore_missing_sheet": false, "include_all_sheets": false, "keep_links": false, "force_fix": true, "subtable": null, "keep_vba": false, "sheets": [{"row_offset": 10, "column_offset": 0, "sheet": "MEDIA PLAN"}], "meta_mapping": {}, "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Campaign Initiative} and {Network / Site}", "_comment": null}], ["rename", {"fields": {"Start Date (DD/MM/YYYY)": "start_date", "End Date (DD/MM/YYYY)": "end_date"}, "subtable": null, "strict": true, "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Campaign_duplicate", "expression": "{Campaign Initiative}", "_comment": null}], ["convertx", {"subtable": null, "field": "start_date", "expression": "str({start_date})[:10]", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Extend End", "expression": "'no'", "_comment": null}], ["convertx", {"subtable": null, "field": "end_date", "expression": "str({end_date})[:10]", "_comment": null}], ["#convertx", {"subtable": null, "field": "Forecast Impressions", "expression": "int({Forecast Impressions})", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Extend Start", "expression": "'no'", "_comment": null}], ["convertx", {"subtable": null, "field": "KPI Cost Type", "expression": "{Buy Type} if {KPI Cost Type}=='Select Any KPI' else 'CPCV' if {KPI Cost Type}=='CPCV 100%' else {KPI Cost Type}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country", "mapping": "ISO Country Codes", "fieldname": "Country_code", "_comment": null}], ["convertx", {"subtable": null, "field": "Country", "expression": "{Country_code} if {Country_code} else {Country}", "_comment": null}], ["convertx", {"subtable": null, "field": "Network / Site", "expression": "str({Network / Site}) + '-' + str({Country})", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Initiative", "expression": "{Campaign Initiative}.replace(\"M\u00e9xico\",\"Mexico\")", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "KPI", "mapping": "Mediaplans | KPI mapping", "fieldname": "target_metric", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "KPI Cost Type", "mapping": "Mediaplans | KPI Cost Type Mapping", "fieldname": "cost_type", "alternative": "", "_comment": null}], ["convertx", {"subtable": null, "field": "target_metric", "expression": "\"clicks\" if {cost_type} == \"CPC\" else {target_metric}", "_comment": null}], ["#convertx", {"subtable": null, "field": "KPI Units", "expression": "{KPI Units}/1000 if {target_metric} == \"impressions\" else {KPI Units}", "_comment": null}], ["convertx", {"subtable": null, "field": "cost_type", "expression": "\"NONE\" if not {cost_type} else {cost_type}", "_comment": null}], ["convertnumbers", {"fields": ["Media Cost", "KPI Units"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "KPI Unit Cost", "expression": "{Media Cost}/{KPI Units} if {KPI Units} else 0", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Vendor Network ID", "expression": "\"_\".join((str({Vendor}).upper(),str({Network / Site}).upper()))", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Vendor Network ID", "mapping": "Vendor Network ID mapping", "fieldname": "Staging Datasource", "if": "", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Datasource", "expression": "\"Other Channels\" if {Staging Datasource} == \"\" else {Staging Datasource} ", "_comment": null}]], "Mediaplan | Step 2": [["#metaaddfield", {"index": null, "subtable": null, "metaname": "custom_meta_information.source_filepath", "fieldname": "Filename", "_comment": null}], ["#convertx", {"subtable": null, "field": "Filename", "expression": "({Filename}.strip('/tmp'))[12:]", "_comment": null}], ["#convertx", {"subtable": null, "field": "Filename", "expression": "(str{Filename}.split(\".xlsx\")[0])", "failonerror": false, "_comment": null}], ["#convertx", {"subtable": null, "field": "Filename", "expression": "(str{Filename}.split('ktbo')[1])", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": null, "value": "ktboClient", "subtable": null, "fieldname": "adverity_client_name", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": null, "value": "3", "subtable": null, "fieldname": "adverity_client_id", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "adverity_media_plan_name", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "adverity_media_plan_id", "_comment": null}], ["set_meta", {"clear": false, "sourcefield": "Filename", "value": null, "subtable": null, "fieldname": "datastream_extract_filename", "_comment": null}], ["fieldmap", {"mappings": [["Name", "str({Network / Site})"], ["Start", "str({start_date})"], ["End", "str({end_date})"], ["Extend Start", "str({Extend Start})"], ["Extend End", "str({Extend End})"], ["Campaign Name", "str(\"_\".join({Campaign Initiative}.split(\"_\")[0:11]) if {Datasource} == \"Other Channels\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:10]) if {Datasource} == \"Sizmek Sas\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Facebook Ads Insights\" else \"_\".join({Campaign Initiative}.split(\"_\")[0:12]) if {Datasource} == \"Google Adwords\" else {Campaign Initiative}).replace(\" \",\"\")"], ["Datasource", "str({Datasource})"], ["Country code", "str({Country})"], ["Campaign MP Label", "str({Temp Campaign Name})"], ["Format Type", "str({Format Type})"], ["Buy Type", "str({Buy Type})"], ["Agency", "str({Agency})"], ["Format", "\"\".join(str({Network / Site}).split(\"-\")[:-1])"], ["client_name", "str({Client})"], ["Brand", "str({Brand})"], ["Region", "str({Region})"], ["City", "str({City})"], ["Temporality", "str({Temporality})"], ["Planned Invers", "str(str(\"$\"+{Total Cost}.split(\".\")[0][:-3]+\",\"+{Total Cost}.split(\".\")[0][-3:])+\".\"+str({Total Cost}+\"0\").split(\".\")[1][:2]).replace(\"$,\",\"$\") if {Total Cost} else 0"], ["Target Metric", "str({target_metric})"], ["Target Value", "{KPI Units} if {KPI Units} else 0"], ["Costs 1", "{Media Cost}"], ["Planned Costs 1", "{Total Cost} if {Total Cost} else 0"], ["Cost Model 1", "str({cost_type})"], ["planned_costs", "{Total Cost} if {Total Cost} else 0"]], "failonerror": false, "subtable": null, "_comment": null}], ["#convertnumbers", {"fields": ["Planned Costs 1", "Costs 1"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["preamble", {"fields": [["PLACEMENT", "", "", "", "", "IDENTIFIERS", "TAGS", "", "", "", "", "", "", "", "", "", "", "", "", "TARGET", "", "COSTS", "", "", "STATICS"]], "subtable": null, "_comment": null}], ["#set_meta", {"clear": false, "sourcefield": null, "value": "Test_mediaplan_ktbo", "subtable": null, "fieldname": "adverity_media_plan_id", "_comment": null}]], "Mediaplans | Unified branding": [["cutout", {"subtable": null, "fields": ["Brand", "Other Brand"], "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Other Brand", "expression": "str({unified_brand}).lower().replace(\" \",\"\")", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Other Brand", "mapping": "General Dashboard | Unified Brand Mapping", "fieldname": "Brand", "_comment": null}]], "Mediaplans | Uppercase campaign name": [["addfieldx", {"subtable": null, "index": null, "field": "Temp Campaign Name", "expression": "{Campaign Initiative}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_copy", "expression": "{start_date}", "_comment": null}], ["convertdates", {"strict": false, "auto": false, "fields": ["date_copy"], "subtable": null, "datetime": true, "format": " %d-%m-%y", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_month", "expression": "int({date_copy}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "mplan_agency", "expression": "\"Mediacom\" if re.match(\".*MCM.*\", {Temp Campaign Name}) else \"KTBO\"", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Initiative", "expression": "str({Temp Campaign Name}).upper()", "failonerror": true, "_comment": null}]], "New occurrence": [["addfieldx", {"index": null, "subtable": null, "field": "New counter", "expression": "1", "_comment": null}]], "Other Campaign | Join Currency conversion": [["convertx", {"subtable": null, "field": "Date", "expression": "{Date}[:10]", "_comment": null}], ["join", {"concatenate": false, "right_select": null, "all": false, "lkey": null, "rkey": null, "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": false, "how": "left", "exclude_tags": null, "distinct": false, "streams": ["Currency Conversion"], "columns": ["BRL to USD", "MXN to USD"], "keys": ["Date"], "lstart": null, "lstop": null, "rstart": null, "rstop": null, "_comment": null}], ["convertnumbers", {"fields": ["BRL to USD", "MXN to USD", "Investment"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Cost in BRL", "expression": "{Investment}*4.17 if re.match(\".*_BRA.*\", {Campaign Name}) else {Investment}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "platform_cost", "expression": "{Investment}", "_comment": null}]], "Other Campaigns | Buy type goal based": [["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "Consumption occasion", "fieldname": "Conpsumtion occasion", "_comment": null}]], "Other Campaigns | Campaign Label from Name": [["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign}.split(\"_\")[:11]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)*',{Campaign}) else ''", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign Name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\").upper() if {campaign_with_taxonomy} else str({Campaign}).replace(\" \",\"\").upper()", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}]], "Other Campaigns | Campaign Name Assignation": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "Campaign_without_Taxonomy", "fieldname": "*", "if": "not {Campaign_duplicate}", "_comment": null}], ["cutout", {"subtable": null, "fields": ["*"], "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Costs", "expression": "{Investment}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.lower().replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buy Type", "_comment": null}], ["convertx", {"failonerror": false, "subtable": null, "field": "New Buy Type", "expression": "\"CPCV\" if re.match(\".*CPCV.*\", {Campaign}) else {New Buy Type}", "_comment": null}]], "Other Campaigns | Uppercase campaign": [["addfieldx", {"subtable": null, "index": null, "field": "Temp Campaign Name", "expression": "{Campaign Name}.upper()", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_copy", "expression": "{Start Date}", "_comment": null}], ["convertdates", {"strict": false, "auto": false, "fields": ["date_copy"], "subtable": null, "datetime": true, "format": " %d-%m-%y", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_month", "expression": "int({date_copy}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "mplan_agency", "expression": "\"Mediacom\" if re.match(\".*MCM.*\", {Temp Campaign Name}) else \"KTBO\"", "_comment": null}]], "Other campaigns |XLSX + reformatting": [["xlsx", {"read_only": true, "include_sheet_name": false, "data_only": true, "guess_types": false, "ignore_missing_sheet": false, "include_all_sheets": false, "keep_links": true, "force_fix": false, "subtable": null, "keep_vba": false, "sheets": [{"row_offset": 0, "column_offset": 0, "sheet": "Other campaigns"}], "meta_mapping": {}, "_comment": null}], ["select", {"complement": false, "subtable": null, "where": "{Start Date}", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "'Kelloggs' if {Brand}=='Hazlo Tuyo' else  'Kelloggs' if {Brand}=='MasterBrand' else  'Kelloggs' if {Brand}=='Masterbrand' else 'Kelloggs' if {Brand}=='Corporate Promotions'else 'Kelloggs Extra' if {Brand}=='Extra' else 'Zucaritas' if re.match('.*Zucaritas.*',{Brand}) else {Brand}", "_comment": null}], ["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country", "mapping": "Other Channels| Country column to Country Code", "fieldname": "country_code", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Date", "expression": "{Start Date}", "_comment": null}], ["convertx", {"failonerror": true, "subtable": null, "field": "Date", "expression": "str({Date})[:10]", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "country_name", "expression": "{Country} if {Country} != \"\" else \"\"", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Campaign_duplicate", "expression": "{Campaign} if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)_(.*)_(.*).*',{Campaign}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "include_original": true, "subtable": null, "pattern": "_", "newfields": ["Agency", "Year", "Country", "Client", "Brand_portfolio", "Temporality", "Initiative", "Adserver", "Consumption occasions"], "field": "Campaign_duplicate", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "Consumption Occasion", "fieldname": "Consumption Occasion", "_comment": null}], ["convertx", {"failonerror": true, "subtable": null, "field": "Campaign", "expression": "{Campaign}.replace(\"M\u00e9xico\", \"Mexico\")", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Costs", "expression": "{Investment}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "unified_brand", "expression": "{Brand}.lower().replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buy Type", "_comment": null}], ["convertx", {"failonerror": false, "subtable": null, "field": "New Buy Type", "expression": "\"CPCV\" if re.match(\".*CPCV.*\", {Campaign}) else {New Buy Type}", "_comment": null}], ["#addfieldx", {"index": null, "subtable": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign}.split(\"_\")[:11]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)*',{Campaign}) else ''", "_comment": null}], ["#addfieldx", {"index": null, "subtable": null, "field": "Campaign Name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\").upper() if {campaign_with_taxonomy} else str({Campaign}).replace(\" \",\"\").upper()", "_comment": null}], ["#cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Campaign Name", "expression": "str({Campaign_duplicate}).replace(\" \",\"\").upper() if {Campaign_duplicate} else str({Campaign}).replace(\" \",\"\").upper()", "_comment": null}], ["join", {"lkey": null, "rkey": null, "how": "left", "errors": "raise", "distinct": false, "all": false, "concatenate": true, "right_presorted": false, "rprefix": "", "right_select": null, "convert_keys": false, "ignore_join_date": true, "include_tags": null, "exclude_tags": null, "lstart": null, "lstop": null, "rstart": null, "rstop": null, "subtable": null, "keys": ["Date"], "streams": ["Currency Conversion"], "columns": ["BRL to USD", "MXN to USD"], "_comment": null}], ["convertnumbers", {"fields": ["BRL to USD", "MXN to USD", "Investment"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Cost in BRL", "expression": "{Investment}*4.17 if re.match(\".*_BRA.*\", {Campaign Name}) else {Investment}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "platform_cost", "expression": "{Investment}", "_comment": null}]], "Reduce Size of Description field": [["convertx", {"subtable": null, "field": "Description", "expression": "{Description}[0:500]", "_comment": null}], ["convertx", {"subtable": null, "field": "Message", "expression": "{Message}[0:500]", "_comment": null}], ["convertx", {"subtable": null, "field": "Description", "expression": "{Message} if not {Description} else {Description}", "_comment": null}]], "Remove Weird Chars in Campaign Field": [["convertx", {"subtable": null, "field": "Campaign", "expression": "{Campaign}.replace(\"M\u00e9xico\", \"Mexico\")", "_comment": null}]], "Select_followers_count": [["select", {"complement": false, "subtable": null, "where": "{user.followers_count}", "_comment": null}], ["cut", {"subtable": null, "fields": ["user.followers_count", "user.username", "Report Date", "user.id"], "_comment": null}]], "Sizemek | Platform equals to Xaxis": [["convertx", {"subtable": null, "field": "Platform", "expression": "\"Xaxis\" if re.match(\".*Xaxis.*\", {Placement Name}) else \"Eikon\" if re.match(\".*Eikon.*\", {Placement Name},re.IGNORECASE) else {Platform}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "cost_type", "expression": "\"CPM\" if re.match(\".*CPM.*\", {Placement Name}) else \"CPV\" if re.match(\".*CPV.*\", {Placement Name}) else \"CPCV\" if re.match(\".*CPCV.*\", {Placement Name}) else \"CPM\"", "_comment": null}]], "Sizmek | ALL - Investment correction": [["addfieldx", {"index": null, "subtable": null, "field": "Original Cost", "expression": "{Total Media Cost}", "_comment": null}], ["convertnumbers", {"fields": ["Original Cost", "Total Media Cost"], "default": 0, "strict": false, "subtable": null, "locale": "en", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Platform Cost", "expression": "({Original Cost}/21.294) if re.match(\"MCMMX.*\", {Campaign Name}) else ({Original Cost}/4347.83) if re.match(\"MCMCO.*\", {Campaign Name}) else {Original Cost}", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Original Platform Cost", "expression": "{Platform Cost}", "_comment": null}]], "Sizmek Mexico | Join Currency Conversion": [["addfieldx", {"subtable": null, "index": null, "field": "Original Cost", "expression": "{Total Media Cost}", "_comment": null}], ["convertx", {"subtable": null, "field": "Date", "expression": "str({Date})[:10]", "_comment": null}], ["join", {"concatenate": false, "right_select": null, "all": false, "lkey": ["Date"], "rkey": ["Date"], "right_presorted": false, "subtable": null, "errors": "raise", "ignore_join_date": true, "include_tags": null, "rprefix": "", "convert_keys": true, "how": "left", "exclude_tags": null, "distinct": false, "streams": ["Currency Conversion"], "columns": ["MXN to USD", "COP to USD", "BRL to USD"], "_comment": null}], ["convertnumbers", {"fields": ["Total Media Cost", "MXN to USD", "COP to USD", "BRL to USD", "Original Cost", "Unit Cost", "* Served Impressions", "Video Started", "Video Fully Played"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["convertx", {"subtable": null, "field": "Total Media Cost", "expression": "({Original Cost}/{MXN to USD}) if re.match(\"MCMMX.*\", {Campaign Name}) else ({Original Cost}/3912.01) if re.match(\"MCMCO.*\", {Campaign Name}) else {Original Cost}", "failonerror": false, "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "convert_unit_cost", "expression": "({Unit Cost}/{MXN to USD}) if re.match(\"MCMMX.*\", {Campaign Name}) else ({Unit Cost}/3912.01) if re.match(\"MCMCO.*\", {Campaign Name}) else {Unit Cost}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "metric_goal", "expression": "{* Served Impressions}/1000 if re.match(\".*CPM.*\", {Placement Name}) else {Video Started} if re.match(\".*CPV.*\", {Placement Name}) else {Video Fully Played} if re.match(\".*CPCV.*\", {Placement Name}) else {* Served Impressions}/1000", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "original_platform_cost", "expression": "({Original Cost}/{MXN to USD}) if re.match(\"MCMMX.*\", {Campaign Name}) else ({Original Cost}/3912.01) if re.match(\"MCMCO.*\", {Campaign Name}) else {Original Cost}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "platform_cost", "expression": "({Original Cost}/21.74) if re.match(\"MCMMX.*\", {Campaign Name}) else ({Original Cost}/4347.826) if re.match(\"MCMCO.*\", {Campaign Name}) else {Original Cost}", "_comment": null}]], "Sizmek SAS - Transformation Script": [["map", {"errors": "raise", "missing": "create", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "Country codes Mapping General", "fieldname": "Country_code", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign Label", "expression": "{Campaign Name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "\"_\".join({Campaign Name}.split(\"_\")[:10]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign Name}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": false, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Adserver", "Consumption occasions", "Platform"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["cutout", {"subtable": null, "fields": [""], "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Brand", "expression": "{Brand_portfolio}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign Name}.split(\"_\")[:10]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign Name}) else ''", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\") if {campaign_with_taxonomy} else {Campaign}.replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["#convertx", {"subtable": null, "field": "Platform", "expression": "\"Xaxis\" if re.match(\"Xaxis.*\", {Site Name}) else {Platform}", "_comment": null}], ["convertx", {"subtable": null, "field": "Ad Format Name", "expression": "\"Connected TV\" if re.match(\".*Connected.*\", {Campaign Name}) else {Ad Format Name}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "Sizmek | Ad Format Dictionary", "fieldname": "New Ad Format", "_comment": null}], ["convertx", {"subtable": null, "field": "Ad Format Name", "expression": "{New Ad Format} if {New Ad Format} else {Ad Format Name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand_portfolio}.lower().replace(\" \",\"\") if {Brand_portfolio} else \"\"", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}], ["convertnumbers", {"fields": ["Total Media Cost"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Platform Cost", "expression": "{Total Media Cost}*0.00027 if {Market} == \"COL\" else {Total Media Cost}*0.05 if {Market} == \"MEX\" else {Total Media Cost}", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buying Type", "_comment": null}], ["convertx", {"subtable": null, "field": "New Buying Type", "expression": "\"CPCV\" if re.match(\".*CPCV.*\", {Campaign Name}) else {New Buying Type}", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "General Dashboard | Unified Brand Mapping", "fieldname": "Brand", "_comment": null}]], "Sizmek | Transformations": [["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "Country codes Mapping General", "fieldname": "Country_code", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign Label", "expression": "{Campaign Name}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign_duplicate", "expression": "\"_\".join({Campaign Name}.split(\"_\")[:9]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign Name}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Adserver", "Consumption occasions", "Platform"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["convertx", {"subtable": null, "field": "Brand", "expression": "{Brand_portfolio} if {Brand} == \"None\" else {Brand}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign Name}.split(\"_\")[:10]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign Name}) else ''", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\") if {campaign_with_taxonomy} else {Campaign Name}.replace(\" \",\"\")", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["convertx", {"subtable": null, "field": "Platform", "expression": "\"Xaxis\" if re.match(\"Xaxis.*\", {Site Name}) else {Platform}", "_comment": null}], ["convertx", {"subtable": null, "field": "Ad Format", "expression": "\"Connected TV\" if re.match(\".*Connected.*\", {Campaign Name}) else {Ad Format}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "Sizmek | Ad Format Dictionary", "fieldname": "New Ad Format", "_comment": null}], ["convertx", {"subtable": null, "field": "Ad Format", "expression": "{New Ad Format} if {New Ad Format} else {Ad Format}", "_comment": null}], ["map", {"flush_table": false, "errors": "ignore", "missing": "create", "notify": true, "subtable": null, "sourcefield": "Campaign Name", "mapping": "General | Buy Type Homologation Values", "fieldname": "New Buying Type", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand_portfolio}.lower().replace(\" \",\"\") if {Brand_portfolio} else \"\"", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}]], "Sizmek | Uppercase campaign": [["addfieldx", {"subtable": null, "index": null, "field": "Temp Campaign Name", "expression": "{Campaign Name}.upper()", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_copy", "expression": "{Date}", "_comment": null}], ["convertdates", {"strict": false, "auto": false, "fields": ["date_copy"], "subtable": null, "datetime": true, "format": " %d-%m-%y", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "date_month", "expression": "int({date_copy}.split(\"-\")[1])", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "mplan_agency", "expression": "\"Mediacom\" if re.match(\".*MCM.*\", {Temp Campaign Name}) else \"KTBO\"", "_comment": null}], ["convertx", {"subtable": null, "field": "Campaign Name", "expression": "{Temp Campaign Name}", "_comment": null}]], "Smart Naming Convention": [["smartnamingconvention", {"subtable": null, "sourcefield": "Campaign", "_comment": null}]], "Twitter | Brand, Country and Date Format": [["#convertx", {"subtable": null, "field": "Date", "expression": "{Date}[:10]", "_comment": null}], ["#convertx", {"subtable": null, "field": "Country", "expression": "'Mexico' if {Country}=='MX' else {Country}", "_comment": null}], ["#convertx", {"subtable": null, "field": "Brand", "expression": "'Kelloggs' if {Brand}==\"Kellogg's\" else {Brand}\t", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Engagements", "expression": "{Interactions}", "_comment": null}], ["convertnumbers", {"fields": ["Clicks URL", "other clicks"], "default": 0, "subtable": null, "strict": false, "locale": "en", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "clicks", "expression": "{Clicks URL}+{other clicks}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.replace(\" \",\"\").lower()", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}]], "Twitter | Campaign Label from Name": [["addfieldx", {"subtable": null, "index": null, "field": "campaign_with_taxonomy", "expression": "\"_\".join({Campaign}.split(\"_\")[:12]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)*',{Campaign}) else ''", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Campaign Name", "expression": "str({campaign_with_taxonomy}).replace(\" \",\"\").upper() if {campaign_with_taxonomy} else str({Campaign}).replace(\" \",\"\").upper()", "_comment": null}], ["cutout", {"subtable": null, "fields": ["campaign_with_taxonomy"], "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "Start Date", "expression": "{Date}", "_comment": null}]], "Twitter Campaigns | Add interactions metric": [["addfieldx", {"subtable": null, "index": null, "field": "interactions", "expression": "{Engagement}", "_comment": null}]], "Twitter Community | Brand": [["convertx", {"subtable": null, "field": "Brand", "expression": "'Kelloggs' if {Brand}==\"Kellogg's\" else {Brand}", "_comment": null}], ["addfieldx", {"subtable": null, "index": null, "field": "unified_brand", "expression": "{Brand}.replace(\" \",\"\").lower()", "_comment": null}], ["cutout", {"subtable": null, "fields": ["Brand"], "_comment": null}]], "Twitter | Country Code & Brand Mapping": [["convertx", {"subtable": null, "field": "Brand", "expression": "'Kelloggs' if {Brand}=='Hazlo Tuyo' else  'Kelloggs' if {Brand}=='MasterBrand' else  'Kelloggs' if {Brand}=='Masterbrand' else 'Kelloggs' if {Brand}=='Corporate Promotions'else 'Kelloggs Extra' if {Brand}=='Extra' else 'Zucaritas' if re.match('.*Zucaritas.*',{Brand}) else {Brand}", "_comment": null}], ["map", {"errors": "raise", "missing": "ignore", "flush_table": false, "notify": true, "subtable": null, "sourcefield": "Country", "mapping": "Country Codes", "fieldname": "country_code", "_comment": null}], ["rename", {"fields": null, "subtable": null, "strict": true, "newname": "Date", "oldname": "Start Date", "_comment": null}], ["addfieldx", {"index": null, "subtable": null, "field": "Campaign_duplicate", "expression": "\"_\".join({Campaign}.split(\"_\")[:10]) if re.match('(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*)\\_(.*).*',{Campaign}) else ''", "_comment": null}], ["splitfield", {"flags": 0, "maxsplit": 0, "include_original": true, "subtable": null, "newfields": ["Agency", "Year", "Market", "Client", "Brand_portfolio", "Temporality", "Initiative", "Vendor", "Platform", "Objective", "Buying Type"], "field": "Campaign_duplicate", "pattern": "_", "_comment": null}], ["map", {"flush_table": false, "errors": "raise", "missing": "ignore", "notify": true, "subtable": null, "sourcefield": "Campaign", "mapping": "Consumption Occasion", "fieldname": "Consumption Occasion", "_comment": null}], ["map", {"flush_table"
